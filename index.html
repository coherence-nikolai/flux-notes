<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flux Notes â€” Your Way of Thinking</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0f1117;--surface:#1a1d27;--surface2:#232638;
  --accent:#7eb8f7;--accent2:#a78bfa;--confusion:#fb923c;
  --success:#6ee7b7;--text:#e8eaf0;--text-muted:#8b90a8;
  --border:rgba(255,255,255,0.08);--radius:16px;--radius-sm:10px;
  --ruler:rgba(126,184,247,0.13);
}
body.day {
  --bg:#f5f0e8;--surface:#fff;--surface2:#f0ebe0;
  --accent:#2563eb;--accent2:#7c3aed;--confusion:#ea580c;
  --success:#059669;--text:#1a1a2e;--text-muted:#6b7280;
  --border:rgba(0,0,0,0.1);--ruler:rgba(37,99,235,0.1);
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Atkinson Hyperlegible',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background 0.3s,color 0.3s;}
body::before{content:'';position:fixed;top:-50%;left:-50%;width:200%;height:200%;
  background:radial-gradient(ellipse at 30% 20%,rgba(126,184,247,0.06) 0%,transparent 50%),
             radial-gradient(ellipse at 70% 80%,rgba(167,139,250,0.06) 0%,transparent 50%);
  pointer-events:none;z-index:0;}
body.day::before{background:radial-gradient(ellipse at 30% 20%,rgba(37,99,235,0.04) 0%,transparent 50%);}
.app{position:relative;z-index:1;max-width:860px;margin:0 auto;padding:16px 16px 110px;}

/* TOPBAR */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 0 8px;}
.logo{font-family:â€˜Nunitoâ€™,sans-serif;font-size:1.6rem;font-weight:800;background:linear-gradient(135deg,var(â€“accent),var(â€“accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.top-controls{display:flex;gap:8px;align-items:center;}
.icon-btn{background:var(â€“surface);border:1px solid var(â€“border);border-radius:50px;padding:7px 14px;cursor:pointer;font-size:0.85rem;color:var(â€“text-muted);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;transition:all 0.2s;white-space:nowrap;}
.icon-btn:hover{border-color:var(â€“accent);color:var(â€“accent);}
.icon-btn.on{border-color:var(â€“accent);color:var(â€“accent);background:rgba(126,184,247,0.1);}

/* CHECK-IN OVERLAY */
.checkin-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:300;display:flex;align-items:center;justify-content:center;padding:20px;}
.checkin-overlay.hidden{display:none;}
.checkin-box{background:var(â€“surface);border-radius:var(â€“radius);padding:32px;max-width:420px;width:100%;text-align:center;}
.checkin-box h2{font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;font-size:1.3rem;margin-bottom:8px;}
.checkin-box p{color:var(â€“text-muted);font-size:0.9rem;margin-bottom:24px;line-height:1.6;}
.checkin-options{display:flex;gap:12px;justify-content:center;margin-bottom:24px;flex-wrap:wrap;}
.checkin-opt{background:var(â€“surface2);border:2px solid var(â€“border);border-radius:var(â€“radius);padding:14px 18px;cursor:pointer;font-size:1.5rem;transition:all 0.2s;flex:1;min-width:80px;}
.checkin-opt:hover{border-color:var(â€“accent);transform:scale(1.05);}
.checkin-opt.selected{border-color:var(â€“accent);background:rgba(126,184,247,0.1);}
.checkin-opt span{display:block;font-family:â€˜Nunitoâ€™,sans-serif;font-size:0.75rem;font-weight:600;color:var(â€“text-muted);margin-top:4px;}
.intention-area{margin-bottom:20px;text-align:left;}
.intention-label{font-family:â€˜Nunitoâ€™,sans-serif;font-size:0.8rem;font-weight:700;color:var(â€“accent);margin-bottom:8px;display:block;text-transform:uppercase;letter-spacing:1px;}
.intention-input{width:100%;background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:12px;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.95rem;outline:none;resize:none;}
.intention-input::placeholder{color:var(â€“text-muted);}
.btn-go{background:linear-gradient(135deg,var(â€“accent),var(â€“accent2));border:none;border-radius:var(â€“radius-sm);color:#fff;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;font-size:1rem;padding:12px 32px;cursor:pointer;width:100%;transition:opacity 0.2s;}
.btn-go:hover{opacity:0.9;}

/* SESSION BAR */
.session-bar{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:12px 16px;display:flex;align-items:center;gap:10px;margin-bottom:16px;}
.session-input{flex:1;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.95rem;outline:none;}
.session-input::placeholder{color:var(â€“text-muted);}
.intention-pill{background:rgba(126,184,247,0.1);border:1px solid rgba(126,184,247,0.2);border-radius:50px;padding:4px 12px;font-size:0.78rem;color:var(â€“accent);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;display:none;}
.intention-pill.visible{display:block;}
.btn-start{background:linear-gradient(135deg,var(â€“accent),var(â€“accent2));border:none;border-radius:var(â€“radius-sm);color:#fff;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:700;font-size:0.85rem;padding:9px 18px;cursor:pointer;white-space:nowrap;transition:opacity 0.2s;}
.btn-start:hover{opacity:0.9;}
.session-indicator{display:none;align-items:center;gap:6px;font-size:0.82rem;color:var(â€“success);font-weight:600;}
.session-indicator.visible{display:flex;}
.dot-live{width:7px;height:7px;border-radius:50%;background:var(â€“success);animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}

/* AMBIENT SOUND */
.ambient-bar{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:10px 16px;display:none;align-items:center;gap:10px;margin-bottom:16px;font-size:0.85rem;color:var(â€“text-muted);}
.ambient-bar.visible{display:flex;}
.ambient-btn{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:50px;padding:5px 12px;cursor:pointer;font-size:0.8rem;color:var(â€“text-muted);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;transition:all 0.2s;}
.ambient-btn.active{border-color:var(â€“accent);color:var(â€“accent);}

/* TABS */
.mode-selector{display:flex;gap:6px;margin-bottom:16px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;}
.mode-selector::-webkit-scrollbar{display:none;}
.mode-btn{background:var(â€“surface);border:1px solid var(â€“border);border-radius:50px;color:var(â€“text-muted);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;font-size:0.82rem;padding:7px 16px;cursor:pointer;transition:all 0.2s;white-space:nowrap;flex-shrink:0;}
.mode-btn.active{background:linear-gradient(135deg,rgba(126,184,247,0.2),rgba(167,139,250,0.2));border-color:var(â€“accent);color:var(â€“accent);}
.mode-btn:hover:not(.active){border-color:var(â€“text-muted);color:var(â€“text);}

/* PANELS */
.panel{display:none;}
.panel.active{display:block;animation:fadeIn 0.25s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* NOTE AREAS */
.note-area{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:18px;min-height:300px;}
.note-textarea{width:100%;min-height:260px;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:1.05rem;line-height:1.85;outline:none;resize:none;}
.note-textarea::placeholder{color:var(â€“text-muted);}

/* CORNELL */
.cornell-grid{display:grid;grid-template-columns:210px 1fr;grid-template-rows:1fr auto;gap:2px;background:var(â€“border);border-radius:var(â€“radius);overflow:hidden;min-height:380px;}
.cornell-cue{background:var(â€“surface);padding:14px;grid-row:1;grid-column:1;}
.cornell-main{background:var(â€“surface);padding:14px;grid-row:1;grid-column:2;}
.cornell-summary{background:var(â€“surface2);padding:14px;grid-row:2;grid-column:1/3;}
.cornell-label{font-family:â€˜Nunitoâ€™,sans-serif;font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(â€“accent2);margin-bottom:8px;display:block;}
.cornell-ta{width:100%;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.92rem;line-height:1.7;outline:none;resize:none;min-height:180px;}
.cornell-ta.summary{min-height:70px;}
.cornell-ta::placeholder{color:var(â€“text-muted);}

/* VOICE */
.voice-panel{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:28px 20px;text-align:center;}
.voice-btn{width:90px;height:90px;border-radius:50%;border:3px solid var(â€“accent);background:rgba(126,184,247,0.1);font-size:2.2rem;cursor:pointer;transition:all 0.2s;margin:0 auto 16px;display:flex;align-items:center;justify-content:center;}
.voice-btn:hover{background:rgba(126,184,247,0.2);transform:scale(1.05);}
.voice-btn.recording{border-color:#ef4444;background:rgba(239,68,68,0.15);animation:pulse-rec 1.5s infinite;}
@keyframes pulse-rec{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,0.3)}50%{box-shadow:0 0 0 14px rgba(239,68,68,0)}}
.voice-status{font-size:0.9rem;color:var(â€“text-muted);margin-bottom:14px;}
.voice-recordings{text-align:left;margin-top:16px;}
.recording-item{background:var(â€“surface2);border-radius:var(â€“radius-sm);padding:10px 14px;margin-bottom:8px;display:flex;align-items:center;gap:10px;font-size:0.88rem;}
.recording-item audio{flex:1;height:34px;}
.rec-time{color:var(â€“text-muted);font-size:0.78rem;white-space:nowrap;}

/* SCAN */
.scan-panel{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:20px;}
.scan-header{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;}
.btn-scan{background:linear-gradient(135deg,var(â€“accent),var(â€“accent2));border:none;border-radius:var(â€“radius-sm);color:#fff;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:700;font-size:0.9rem;padding:10px 20px;cursor:pointer;transition:opacity 0.2s;}
.btn-scan:hover{opacity:0.9;}
.btn-secondary{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);color:var(â€“text);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;font-size:0.88rem;padding:10px 18px;cursor:pointer;transition:all 0.2s;}
.btn-secondary:hover{border-color:var(â€“accent);color:var(â€“accent);}
#cameraPreview{width:100%;border-radius:var(â€“radius-sm);margin-bottom:12px;display:none;max-height:220px;object-fit:cover;}
#scanCanvas{display:none;}
.scan-cards{margin-top:4px;}
.scan-card{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);margin-bottom:12px;overflow:hidden;}
.scan-card-grid{display:grid;grid-template-columns:1fr 1fr;gap:0;}
.scan-col{padding:12px;}
.scan-col:first-child{border-right:1px solid var(â€“border);}
.scan-col-label{font-family:â€˜Nunitoâ€™,sans-serif;font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(â€“accent2);margin-bottom:6px;display:block;}
.scan-captured{font-size:0.85rem;line-height:1.6;color:var(â€“text-muted);white-space:pre-wrap;}
.scan-note-ta{width:100%;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.88rem;line-height:1.6;outline:none;resize:none;min-height:80px;}
.scan-note-ta::placeholder{color:var(â€“text-muted);}
.scan-empty{text-align:center;padding:32px;color:var(â€“text-muted);font-size:0.9rem;}

/* RESEARCH */
.research-anchor{background:linear-gradient(135deg,rgba(126,184,247,0.1),rgba(167,139,250,0.1));border:1px solid rgba(126,184,247,0.25);border-radius:var(â€“radius);padding:14px 16px;margin-bottom:16px;position:sticky;top:0;z-index:10;}
.anchor-label{font-family:â€˜Nunitoâ€™,sans-serif;font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(â€“accent);margin-bottom:6px;display:block;}
.anchor-input{width:100%;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:1rem;font-weight:700;outline:none;}
.anchor-input::placeholder{color:var(â€“text-muted);font-weight:400;}
.source-cards{margin-bottom:16px;}
.source-card{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);margin-bottom:14px;overflow:hidden;}
.source-card-header{padding:12px 16px;background:var(â€“surface2);display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.source-type-select{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);color:var(â€“text);font-family:â€˜Nunitoâ€™,sans-serif;font-size:0.8rem;padding:4px 8px;outline:none;cursor:pointer;}
.source-title-input{flex:1;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.9rem;outline:none;min-width:120px;}
.source-title-input::placeholder{color:var(â€“text-muted);}
.relevance-btns{display:flex;gap:4px;}
.rel-btn{background:var(â€“surface);border:1px solid var(â€“border);border-radius:50px;padding:3px 10px;font-size:0.75rem;cursor:pointer;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;transition:all 0.2s;}
.rel-btn[data-rel=â€œgreenâ€].active{background:#dcfce7;border-color:#16a34a;color:#16a34a;}
.rel-btn[data-rel=â€œamberâ€].active{background:#fef3c7;border-color:#d97706;color:#d97706;}
.rel-btn[data-rel=â€œredâ€].active{background:#fee2e2;border-color:#dc2626;color:#dc2626;}
.source-card-body{display:grid;grid-template-columns:1fr 1fr;gap:0;}
.source-col{padding:12px 16px;}
.source-col:first-child{border-right:1px solid var(â€“border);}
.source-col-label{font-family:â€˜Nunitoâ€™,sans-serif;font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(â€“accent2);margin-bottom:6px;display:block;}
.source-ta{width:100%;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.88rem;line-height:1.6;outline:none;resize:none;min-height:80px;}
.source-ta::placeholder{color:var(â€“text-muted);}
.source-card-footer{padding:10px 16px;background:var(â€“surface2);border-top:1px solid var(â€“border);}
.apa-preview{font-size:0.82rem;color:var(â€“text-muted);font-style:italic;line-height:1.5;}
.apa-fields{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-bottom:10px;}
.apa-input{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:7px 10px;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.82rem;outline:none;width:100%;}
.apa-input::placeholder{color:var(â€“text-muted);}
.apa-resources{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
.apa-link{font-size:0.78rem;color:var(â€“accent);text-decoration:none;border:1px solid rgba(126,184,247,0.2);border-radius:50px;padding:3px 10px;transition:all 0.2s;}
.apa-link:hover{background:rgba(126,184,247,0.1);}
.btn-add-source{background:var(â€“surface);border:2px dashed var(â€“border);border-radius:var(â€“radius);padding:14px;width:100%;cursor:pointer;color:var(â€“text-muted);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;font-size:0.9rem;transition:all 0.2s;margin-bottom:16px;}
.btn-add-source:hover{border-color:var(â€“accent);color:var(â€“accent);}

/* REVIEW */
.review-card{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:18px;margin-bottom:16px;}
.review-card h3{font-family:â€˜Nunitoâ€™,sans-serif;font-weight:700;font-size:0.95rem;color:var(â€“accent);margin-bottom:10px;}
.review-content{font-size:0.93rem;line-height:1.85;color:var(â€“text-muted);white-space:pre-wrap;word-break:break-word;position:relative;}
.review-content.ruler-on{background:repeating-linear-gradient(to bottom,transparent,transparent calc(1.85em - 1px),var(â€“ruler) calc(1.85em - 1px),var(â€“ruler) 1.85em);background-size:100% 1.85em;}
.bionic-word b{font-weight:800;color:var(â€“text);}
.section-title{font-family:â€˜Nunitoâ€™,sans-serif;font-weight:700;font-size:0.78rem;text-transform:uppercase;letter-spacing:1.5px;color:var(â€“text-muted);margin-bottom:10px;}
.export-btn{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);color:var(â€“text);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;font-size:0.88rem;padding:9px 18px;cursor:pointer;transition:all 0.2s;margin-right:8px;margin-top:10px;}
.export-btn:hover{border-color:var(â€“accent);color:var(â€“accent);}

/* 3 THINGS OVERLAY */
.three-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:300;display:flex;align-items:center;justify-content:center;padding:20px;}
.three-overlay.hidden{display:none;}
.three-box{background:var(â€“surface);border-radius:var(â€“radius);padding:32px;max-width:420px;width:100%;}
.three-box h2{font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;font-size:1.2rem;margin-bottom:6px;}
.three-box p{color:var(â€“text-muted);font-size:0.88rem;margin-bottom:20px;line-height:1.6;}
.three-input{width:100%;background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:10px 12px;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.95rem;outline:none;margin-bottom:8px;}
.three-input::placeholder{color:var(â€“text-muted);}
.intention-reflect{background:rgba(126,184,247,0.08);border:1px solid rgba(126,184,247,0.2);border-radius:var(â€“radius-sm);padding:12px;margin-bottom:16px;font-size:0.85rem;color:var(â€“text-muted);line-height:1.6;display:none;}
.intention-reflect strong{color:var(â€“accent);}

/* CONFUSION */
.confusion-zone{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:100;}
.confusion-btn{background:linear-gradient(135deg,var(â€“confusion),#f97316);border:none;border-radius:50px;color:white;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;font-size:0.95rem;padding:13px 26px;cursor:pointer;box-shadow:0 4px 24px rgba(251,146,60,0.4);transition:all 0.2s;display:flex;align-items:center;gap:8px;}
.confusion-btn:hover{transform:scale(1.05);}
.confusion-btn:active{transform:scale(0.97);}
.confusion-count{background:rgba(255,255,255,0.25);border-radius:50px;padding:2px 9px;font-size:0.82rem;}
.confusion-log{margin-top:20px;}
.confusion-item{background:var(â€“surface);border:1px solid rgba(251,146,60,0.2);border-left:3px solid var(â€“confusion);border-radius:var(â€“radius-sm);padding:10px 14px;margin-bottom:8px;display:flex;align-items:flex-start;gap:10px;animation:slideIn 0.3s ease;}
@keyframes slideIn{from{opacity:0;transform:translateX(-6px)}to{opacity:1;transform:translateX(0)}}
.confusion-timestamp{font-size:0.78rem;color:var(â€“confusion);font-weight:600;white-space:nowrap;margin-top:2px;}
.confusion-note-input{flex:1;background:transparent;border:none;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.88rem;outline:none;resize:none;line-height:1.5;}
.confusion-note-input::placeholder{color:var(â€“text-muted);font-style:italic;}

/* TOOLS */
.tools-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:10px;}
.tool-card{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:14px;text-decoration:none;color:var(â€“text);transition:all 0.2s;display:block;}
.tool-card:hover{border-color:var(â€“accent);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.25);}
.tool-icon{font-size:1.6rem;margin-bottom:6px;}
.tool-name{font-family:â€˜Nunitoâ€™,sans-serif;font-weight:700;font-size:0.95rem;margin-bottom:3px;}
.tool-desc{font-size:0.8rem;color:var(â€“text-muted);line-height:1.5;}
.tool-tag{display:inline-block;margin-top:6px;font-size:0.7rem;background:rgba(126,184,247,0.12);color:var(â€“accent);border-radius:50px;padding:2px 9px;font-weight:600;}

/* TOAST */
.toast{position:fixed;top:20px;right:20px;background:var(â€“confusion);color:white;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:700;font-size:0.88rem;padding:11px 18px;border-radius:var(â€“radius-sm);z-index:400;opacity:0;transform:translateY(-6px);transition:all 0.3s;pointer-events:none;max-width:280px;}
.toast.show{opacity:1;transform:translateY(0);}

*:focus-visible{outline:2px solid var(â€“accent);outline-offset:2px;}
@media(max-width:560px){
.cornell-grid,.source-card-body,.scan-card-grid{grid-template-columns:1fr;}
.cornell-cue,.cornell-main{grid-column:1;}
.cornell-summary{grid-column:1;}
.source-col:first-child,.scan-col:first-child{border-right:none;border-bottom:1px solid var(â€“border);}
}

/* VISUAL NOTES */
.visual-panel{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);padding:16px;}
.visual-toolbar{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap;}
.vt-btn{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:7px 13px;cursor:pointer;font-size:0.82rem;color:var(â€“text-muted);font-family:â€˜Nunitoâ€™,sans-serif;font-weight:600;transition:all 0.2s;white-space:nowrap;}
.vt-btn:hover{border-color:var(â€“accent);color:var(â€“accent);}
.vt-btn.active{border-color:var(â€“accent);color:var(â€“accent);background:rgba(126,184,247,0.12);}
.vt-sep{width:1px;height:24px;background:var(â€“border);flex-shrink:0;}
.vt-color{width:26px;height:26px;border-radius:50%;border:2px solid transparent;cursor:pointer;transition:transform 0.15s;flex-shrink:0;}
.vt-color:hover{transform:scale(1.15);}
.vt-color.active{border-color:var(â€“text);}
.vt-size{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:5px 8px;color:var(â€“text);font-size:0.82rem;outline:none;cursor:pointer;width:60px;}
.visual-canvas-wrap{position:relative;border-radius:var(â€“radius-sm);overflow:hidden;touch-action:none;}
#visualCanvas{display:block;width:100%;cursor:crosshair;border-radius:var(â€“radius-sm);}
.pixabay-section{margin-top:14px;}
.pixabay-search-row{display:flex;gap:8px;margin-bottom:10px;}
.pixabay-input{flex:1;background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:9px 12px;color:var(â€“text);font-family:â€˜Atkinson Hyperlegibleâ€™,sans-serif;font-size:0.9rem;outline:none;}
.pixabay-input::placeholder{color:var(â€“text-muted);}
.pixabay-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:8px;max-height:200px;overflow-y:auto;}
.pixabay-img{width:100%;height:70px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:all 0.2s;}
.pixabay-img:hover{border-color:var(â€“accent);transform:scale(1.03);}
.pixabay-empty{color:var(â€“text-muted);font-size:0.85rem;padding:16px 0;text-align:center;}
.upload-img-label{cursor:pointer;}
</style>

</head>
<body>

<div class="app">
  <div class="topbar">
    <div class="logo">âœ¦ Flux Notes</div>
    <div class="top-controls">
      <button class="icon-btn" id="themeBtn">â˜€ï¸ Day</button>
      <button class="icon-btn" id="ambientToggle">ğŸ”‰ Sound</button>
    </div>
  </div>

  <div class="ambient-bar" id="ambientBar">
    <span style="font-size:0.85rem;color:var(--text-muted)">Background sound:</span>
    <button class="ambient-btn" data-freq="brown">ğŸŸ¤ Brown noise</button>
    <button class="ambient-btn" data-freq="white">â¬œ White noise</button>
    <button class="ambient-btn" data-freq="off">âœ• Off</button>
  </div>

  <div class="session-bar">
    <input class="session-input" id="sessionName" type="text" placeholder="Session name..." aria-label="Session name"/>
    <div class="session-indicator" id="sessionIndicator"><span class="dot-live"></span>Live</div>
    <button class="btn-start" id="startBtn">Start Session</button>
  </div>

  <div class="mode-selector" role="tablist">
    <button class="mode-btn active" data-mode="free">âœï¸ Free Notes</button>
    <button class="mode-btn" data-mode="cornell">ğŸ“‹ Cornell</button>
    <button class="mode-btn" data-mode="voice">ğŸ™ï¸ Voice</button>
    <button class="mode-btn" data-mode="scan">ğŸ“· Scan</button>
    <button class="mode-btn" data-mode="research">ğŸ”¬ Research</button>
    <button class="mode-btn" data-mode="visual">ğŸ¨ Visual Notes</button>
    <button class="mode-btn" data-mode="review">ğŸ” Review</button>
    <button class="mode-btn" data-mode="tools">ğŸ”— Tools</button>
  </div>

  <!-- FREE NOTES -->

  <div class="panel active" id="panel-free">
    <div class="note-area">
      <textarea class="note-textarea" id="freeNotes" placeholder="Just start writing. No rules. No judgment. Your thoughts belong hereâ€¦"></textarea>
    </div>
    <div class="confusion-log" id="confusionLog-free"></div>
  </div>

  <!-- CORNELL -->

  <div class="panel" id="panel-cornell">
    <div class="cornell-grid">
      <div class="cornell-cue">
        <span class="cornell-label">â“ Questions &amp; Cues</span>
        <textarea class="cornell-ta" id="cornellCue" placeholder="Key questions, things to come back to, words you don't knowâ€¦"></textarea>
      </div>
      <div class="cornell-main">
        <span class="cornell-label">ğŸ“ Main Notes</span>
        <textarea class="cornell-ta" id="cornellMain" placeholder="Your main notes. Don't worry about it being perfectâ€¦"></textarea>
      </div>
      <div class="cornell-summary">
        <span class="cornell-label">ğŸ’¡ Summary â€” fill this in after the lecture</span>
        <textarea class="cornell-ta summary" id="cornellSummary" placeholder="In your own words: what were the 3 key things from this lecture?"></textarea>
      </div>
    </div>
    <div class="confusion-log" id="confusionLog-cornell"></div>
  </div>

  <!-- VOICE -->

  <div class="panel" id="panel-voice">
    <div class="voice-panel">
      <button class="voice-btn" id="voiceBtn" aria-label="Record voice note">ğŸ™ï¸</button>
      <div class="voice-status" id="voiceStatus">Tap to record a voice note</div>
      <p style="font-size:0.83rem;color:var(--text-muted);max-width:300px;margin:0 auto;line-height:1.6;">When typing feels like too much â€” just speak.</p>
      <div class="voice-recordings" id="voiceRecordings"></div>
    </div>
    <div class="confusion-log" id="confusionLog-voice"></div>
  </div>

  <!-- SCAN -->

  <div class="panel" id="panel-scan">
    <div class="scan-panel">
      <p style="font-size:0.88rem;color:var(--text-muted);margin-bottom:14px;line-height:1.6;">Point your camera at a slide or page. Tap <strong>Capture</strong> to grab the text and add your own notes alongside it.</p>
      <div class="scan-header">
        <button class="btn-scan" id="startCameraBtn">ğŸ“· Start Camera</button>
        <button class="btn-scan" id="captureBtn" style="display:none">âš¡ Capture</button>
        <button class="btn-secondary" id="stopCameraBtn" style="display:none">âœ• Stop</button>
        <label class="btn-secondary" style="cursor:pointer">ğŸ“ Upload Image<input type="file" id="imageUpload" accept="image/*" style="display:none"></label>
      </div>
      <video id="cameraPreview" autoplay playsinline></video>
      <canvas id="scanCanvas"></canvas>
      <div class="scan-cards" id="scanCards">
        <div class="scan-empty">No captures yet â€” start your camera or upload an image of a slide.</div>
      </div>
    </div>
    <div class="confusion-log" id="confusionLog-scan"></div>
  </div>

  <!-- RESEARCH -->

  <div class="panel" id="panel-research">
    <div class="research-anchor">
      <span class="anchor-label">ğŸ“Œ Your assignment question â€” stays visible the whole time</span>
      <input class="anchor-input" id="assignmentQ" type="text" placeholder="Type your assignment question or focus hereâ€¦">
    </div>
    <div class="source-cards" id="sourceCards"></div>
    <button class="btn-add-source" id="addSourceBtn">+ Add a source</button>
    <div class="confusion-log" id="confusionLog-research"></div>
  </div>

  <!-- VISUAL NOTES -->

  <div class="panel" id="panel-visual">
    <div class="visual-panel">
      <div class="visual-toolbar">
        <button class="vt-btn active" id="vt-draw" title="Draw">âœï¸ Draw</button>
        <button class="vt-btn" id="vt-text" title="Add text label">T Text</button>
        <button class="vt-btn" id="vt-erase" title="Eraser">âŒ« Erase</button>
        <div class="vt-sep"></div>
        <span style="font-size:0.78rem;color:var(--text-muted);font-family:'Nunito',sans-serif;">Size</span>
        <select class="vt-size" id="vt-size-select">
          <option value="3">Thin</option>
          <option value="6" selected>Medium</option>
          <option value="12">Thick</option>
          <option value="24">Bold</option>
        </select>
        <div class="vt-sep"></div>
        <div class="vt-color active" style="background:#7eb8f7;" data-color="#7eb8f7" title="Blue"></div>
        <div class="vt-color" style="background:#a78bfa;" data-color="#a78bfa" title="Purple"></div>
        <div class="vt-color" style="background:#6ee7b7;" data-color="#6ee7b7" title="Green"></div>
        <div class="vt-color" style="background:#fb923c;" data-color="#fb923c" title="Orange"></div>
        <div class="vt-color" style="background:#f9a8d4;" data-color="#f9a8d4" title="Pink"></div>
        <div class="vt-color" style="background:#e8eaf0;" data-color="#e8eaf0" title="White"></div>
        <div class="vt-sep"></div>
        <button class="vt-btn" id="vt-clear" title="Clear canvas">ğŸ—‘ï¸ Clear</button>
        <button class="vt-btn" id="vt-save-png" title="Download as image">â¬‡ï¸ Save Image</button>
        <label class="vt-btn upload-img-label" title="Upload an image to canvas">ğŸ“ Add Image<input type="file" id="vt-upload" accept="image/*" style="display:none"></label>
      </div>
      <div class="visual-canvas-wrap" id="visualCanvasWrap">
        <canvas id="visualCanvas"></canvas>
      </div>
      <div class="pixabay-section">
        <div class="section-title" style="margin-bottom:8px">ğŸ–¼ï¸ Search free images to add to your canvas (Pixabay)</div>
        <div class="pixabay-search-row">
          <input class="pixabay-input" id="pixabayInput" type="text" placeholder="Search e.g. brain, photosynthesis, war, diagramâ€¦">
          <button class="vt-btn" id="pixabaySearchBtn" style="padding:9px 16px;">Search</button>
        </div>
        <div class="pixabay-grid" id="pixabayGrid">
          <div class="pixabay-empty">Search for an image above to find and add it to your canvas.</div>
        </div>
      </div>
    </div>
    <div class="confusion-log" id="confusionLog-visual"></div>
  </div>

  <!-- REVIEW -->

  <div class="panel" id="panel-review">
    <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center;">
      <span class="section-title" style="margin:0">Reading aids:</span>
      <button class="icon-btn" id="bionicBtn">âš¡ Bionic Reading</button>
      <button class="icon-btn" id="rulerBtn">ğŸ“ Reading Ruler</button>
    </div>
    <div class="review-card">
      <h3>Free Notes</h3>
      <div class="review-content" id="review-free">â€”</div>
    </div>
    <div class="review-card">
      <h3>Cornell â€” Cues</h3>
      <div class="review-content" id="review-cue">â€”</div>
      <h3 style="margin-top:14px">Cornell â€” Main Notes</h3>
      <div class="review-content" id="review-main">â€”</div>
      <h3 style="margin-top:14px">Cornell â€” Summary</h3>
      <div class="review-content" id="review-summary">â€”</div>
    </div>
    <div class="review-card">
      <h3>3 Things I Remembered</h3>
      <div class="review-content" id="review-three">â€”</div>
    </div>
    <div class="review-card">
      <div class="section-title">ğŸŸ  Confusion Moments â€” find these in your recording</div>
      <div id="review-confusion"></div>
    </div>
    <button class="export-btn" id="copyBtn">ğŸ“‹ Copy All Notes</button>
    <button class="export-btn" id="downloadBtn">â¬‡ï¸ Download</button>
  </div>

  <!-- TOOLS -->

  <div class="panel" id="panel-tools">
    <div class="section-title" style="margin-bottom:14px">Specialist tools for different needs</div>
    <div class="tools-grid">
      <a href="https://otter.ai" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸ§</div><div class="tool-name">Otter.ai</div><div class="tool-desc">Live lecture transcription. Never miss a word.</div><span class="tool-tag">ADHD Â· Dyslexia</span></a>
      <a href="https://ankiweb.net" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸƒ</div><div class="tool-name">Anki</div><div class="tool-desc">Spaced repetition flashcards for memory.</div><span class="tool-tag">ADHD Â· All</span></a>
      <a href="https://speechify.com" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸ”Š</div><div class="tool-name">Speechify</div><div class="tool-desc">Any text read aloud. Listen instead of read.</div><span class="tool-tag">Dyslexia Â· Autism</span></a>
      <a href="https://www.mindmeister.com" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸ•¸ï¸</div><div class="tool-name">MindMeister</div><div class="tool-desc">Visual mind mapping for web thinkers.</div><span class="tool-tag">Autism Â· Visual</span></a>
      <a href="https://www.naturalreaders.com" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸ“–</div><div class="tool-name">Natural Reader</div><div class="tool-desc">Free TTS with dyslexia-friendly fonts.</div><span class="tool-tag">Dyslexia</span></a>
      <a href="https://owl.purdue.edu/owl/research_and_citation/apa_style/apa_formatting_and_style_guide/general_format.html" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸ“š</div><div class="tool-name">Purdue OWL â€” APA 7</div><div class="tool-desc">The gold standard APA 7 guide. Clear and free.</div><span class="tool-tag">Referencing</span></a>
      <a href="https://apastyle.apa.org" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸ›ï¸</div><div class="tool-name">APA Style Official</div><div class="tool-desc">Official APA blog with examples for tricky sources.</div><span class="tool-tag">Referencing</span></a>
      <a href="https://notion.so" target="_blank" rel="noopener" class="tool-card"><div class="tool-icon">ğŸ—‚ï¸</div><div class="tool-name">Notion</div><div class="tool-desc">Connect ideas across subjects your own way.</div><span class="tool-tag">Organisation</span></a>
    </div>
  </div>
</div>

<div class="confusion-zone">
  <button class="confusion-btn" id="confusionBtn" aria-label="Log confusion moment">
    ğŸ¤¯ Lost the thread <span class="confusion-count" id="confusionCount">0</span>
  </button>
</div>
<div class="toast" id="toast"></div>

<script>
window.addEventListener('load', function() {
try {

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var sessionActive = false;
var sessionStartTime = null;
var confusionPoints = [];
var mediaRecorder = null;
var audioChunks = [];
var isRecording = false;
var recordingCount = 0;
var cameraStream = null;
var sourceCardCount = 0;
var scanCardCount = 0;
var bionicOn = false;
var rulerOn = false;
var audioCtx = null;
var noiseNode = null;
var isDark = true;

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function el(id) { return document.getElementById(id); }

function tap(id, fn) {
  var node = el(id);
  if (!node) return;
  node.addEventListener('click', fn);
  node.addEventListener('touchend', function(e) {
    e.preventDefault();
    fn.call(this, e);
  });
}

function tapAll(selector, fn) {
  document.querySelectorAll(selector).forEach(function(node) {
    node.addEventListener('click', fn);
    node.addEventListener('touchend', function(e) {
      e.preventDefault();
      fn.call(this, e);
    });
  });
}

function showToast(msg) {
  var t = el('toast');
  if (!t) return;
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2800);
}

function switchMode(mode) {
  document.querySelectorAll('.panel').forEach(function(p) { p.classList.remove('active'); });
  document.querySelectorAll('.mode-btn').forEach(function(b) { b.classList.remove('active'); });
  var panel = el('panel-' + mode);
  if (panel) panel.classList.add('active');
  var btn = document.querySelector('[data-mode="' + mode + '"]');
  if (btn) btn.classList.add('active');
  if (mode === 'review') buildReview();
}

// â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap('themeBtn', function() {
  isDark = !isDark;
  document.body.classList.toggle('day', !isDark);
  el('themeBtn').textContent = isDark ? 'â˜€ï¸ Day' : 'ğŸŒ™ Night';
});

// â”€â”€ AMBIENT SOUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap('ambientToggle', function() {
  el('ambientBar').classList.toggle('visible');
  el('ambientToggle').classList.toggle('on');
});

tapAll('.ambient-btn', function() {
  document.querySelectorAll('.ambient-btn').forEach(function(b) { b.classList.remove('active'); });
  this.classList.add('active');
  playNoise(this.getAttribute('data-freq'));
});

function playNoise(type) {
  if (noiseNode) { try { noiseNode.stop(); } catch(e){} noiseNode = null; }
  if (!type || type === 'off') return;
  try {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    var bufferSize = 2 * audioCtx.sampleRate;
    var buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    var data = buffer.getChannelData(0);
    if (type === 'white') {
      for (var i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
    } else {
      var b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;
      for (var i = 0; i < bufferSize; i++) {
        var w = Math.random() * 2 - 1;
        b0=0.99886*b0+w*0.0555179; b1=0.99332*b1+w*0.0750759;
        b2=0.96900*b2+w*0.1538520; b3=0.86650*b3+w*0.3104856;
        b4=0.55000*b4+w*0.5329522; b5=-0.7616*b5-w*0.0168980;
        data[i] = (b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.11; b6=w*0.115926;
      }
    }
    var src = audioCtx.createBufferSource();
    src.buffer = buffer; src.loop = true;
    var gain = audioCtx.createGain(); gain.gain.value = 0.15;
    src.connect(gain); gain.connect(audioCtx.destination);
    src.start(); noiseNode = src;
  } catch(e) { showToast('Audio not supported on this device'); }
}

// â”€â”€ SESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap('startBtn', function() {
  if (!sessionActive) {
    sessionActive = true;
    sessionStartTime = new Date();
    el('startBtn').textContent = 'End Session';
    el('startBtn').style.background = 'linear-gradient(135deg,#6b7280,#4b5563)';
    el('sessionIndicator').classList.add('visible');
  } else {
    sessionActive = false;
    el('startBtn').textContent = 'Start Session';
    el('startBtn').style.background = '';
    el('sessionIndicator').classList.remove('visible');
    buildReview();
    switchMode('review');
  }
});

// â”€â”€ MODE TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tapAll('.mode-btn', function() {
  switchMode(this.getAttribute('data-mode'));
});

// â”€â”€ CONFUSION BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap('confusionBtn', function() {
  var now = new Date();
  var timeStr;
  if (sessionStartTime) {
    var e = Math.floor((now - sessionStartTime) / 1000);
    timeStr = Math.floor(e/60).toString().padStart(2,'0') + ':' + (e%60).toString().padStart(2,'0') + ' in';
  } else {
    timeStr = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  }
  confusionPoints.push({ time: timeStr, note: '' });
  el('confusionCount').textContent = confusionPoints.length;
  renderConfusionItems();
  showToast('Logged â€” go back to your recording at this point');
});

function renderConfusionItems() {
  var ids = ['confusionLog-free','confusionLog-cornell','confusionLog-voice','confusionLog-scan','confusionLog-research','confusionLog-visual'];
  ids.forEach(function(id) {
    var node = el(id);
    if (!node) return;
    if (!confusionPoints.length) { node.innerHTML = ''; return; }
    var html = '<div class="section-title" style="margin-top:20px">ğŸŸ  Confusion Moments</div>';
    confusionPoints.forEach(function(cp, i) {
      html += '<div class="confusion-item"><div class="confusion-timestamp">' + cp.time + '</div>' +
        '<textarea class="confusion-note-input" data-index="' + i + '" placeholder="What confused you? Fill in afterâ€¦" rows="2">' + cp.note + '</textarea></div>';

```
});
node.innerHTML = html;
node.querySelectorAll('.confusion-note-input').forEach(function(ta) {
  ta.addEventListener('change', function() {
    var idx = parseInt(this.getAttribute('data-index'));
    if (confusionPoints[idx]) confusionPoints[idx].note = this.value;
  });
});
```

});
}

// â”€â”€ VOICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap(â€˜voiceBtnâ€™, function() {
if (!isRecording) {
navigator.mediaDevices.getUserMedia({ audio: true }).then(function(stream) {
mediaRecorder = new MediaRecorder(stream);
audioChunks = [];
mediaRecorder.addEventListener(â€˜dataavailableâ€™, function(e) { audioChunks.push(e.data); });
mediaRecorder.addEventListener(â€˜stopâ€™, function() {
var blob = new Blob(audioChunks, { type: â€˜audio/webmâ€™ });
var url = URL.createObjectURL(blob);
recordingCount++;
var now = new Date().toLocaleTimeString([], {hour:â€˜2-digitâ€™,minute:â€˜2-digitâ€™});
var c = el(â€˜voiceRecordingsâ€™);
if (!c.querySelector(â€™.section-titleâ€™)) {
var t = document.createElement(â€˜divâ€™);
t.className = â€˜section-titleâ€™; t.style.marginBottom = â€˜10pxâ€™;
t.textContent = â€˜Your voice notesâ€™; c.appendChild(t);
}
var item = document.createElement(â€˜divâ€™); item.className = â€˜recording-itemâ€™;
var audio = document.createElement(â€˜audioâ€™); audio.controls = true; audio.src = url;
item.innerHTML = â€˜<span>ğŸ™ï¸ #â€™ + recordingCount + â€˜</span>â€™;
item.appendChild(audio);
var te = document.createElement(â€˜spanâ€™); te.className = â€˜rec-timeâ€™; te.textContent = now;
item.appendChild(te); c.appendChild(item);
stream.getTracks().forEach(function(t) { t.stop(); });
});
mediaRecorder.start(); isRecording = true;
el(â€˜voiceBtnâ€™).classList.add(â€˜recordingâ€™);
el(â€˜voiceBtnâ€™).textContent = â€˜â¹ï¸â€™;
el(â€˜voiceStatusâ€™).textContent = â€˜Recordingâ€¦ tap to stopâ€™;
}).catch(function() {
el(â€˜voiceStatusâ€™).textContent = â€˜Microphone access needed â€” check browser settingsâ€™;
});
} else {
mediaRecorder.stop(); isRecording = false;
el(â€˜voiceBtnâ€™).classList.remove(â€˜recordingâ€™);
el(â€˜voiceBtnâ€™).textContent = â€˜ğŸ™ï¸â€™;
el(â€˜voiceStatusâ€™).textContent = â€˜Saved âœ“ Tap to record anotherâ€™;
}
});

// â”€â”€ SCAN / CAMERA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap(â€˜startCameraBtnâ€™, function() {
navigator.mediaDevices.getUserMedia({ video: { facingMode: â€˜environmentâ€™ } }).then(function(stream) {
cameraStream = stream;
var vid = el(â€˜cameraPreviewâ€™);
vid.srcObject = stream; vid.style.display = â€˜blockâ€™;
el(â€˜captureBtnâ€™).style.display = â€˜inline-flexâ€™;
el(â€˜stopCameraBtnâ€™).style.display = â€˜inline-flexâ€™;
el(â€˜startCameraBtnâ€™).style.display = â€˜noneâ€™;
}).catch(function() { showToast(â€˜Camera access needed â€” check browser settingsâ€™); });
});

tap(â€˜stopCameraBtnâ€™, function() {
if (cameraStream) cameraStream.getTracks().forEach(function(t) { t.stop(); });
el(â€˜cameraPreviewâ€™).style.display = â€˜noneâ€™;
el(â€˜stopCameraBtnâ€™).style.display = â€˜noneâ€™;
el(â€˜captureBtnâ€™).style.display = â€˜noneâ€™;
el(â€˜startCameraBtnâ€™).style.display = â€˜inline-flexâ€™;
});

tap(â€˜captureBtnâ€™, function() {
var vid = el(â€˜cameraPreviewâ€™);
var canvas = el(â€˜scanCanvasâ€™);
canvas.width = vid.videoWidth; canvas.height = vid.videoHeight;
canvas.getContext(â€˜2dâ€™).drawImage(vid, 0, 0);
addScanCard(canvas.toDataURL(â€˜image/pngâ€™), â€˜Captured â€” add your notes alongsideâ€™);
showToast(â€˜Slide captured âœ“â€™);
});

el(â€˜imageUploadâ€™).addEventListener(â€˜changeâ€™, function(e) {
var file = e.target.files[0]; if (!file) return;
var reader = new FileReader();
reader.onload = function(ev) { addScanCard(ev.target.result, â€˜Image uploadedâ€™); };
reader.readAsDataURL(file);
});

function addScanCard(imgSrc, capturedText) {
scanCardCount++;
var container = el(â€˜scanCardsâ€™);
var empty = container.querySelector(â€™.scan-emptyâ€™);
if (empty) empty.remove();
var card = document.createElement(â€˜divâ€™); card.className = â€˜scan-cardâ€™;
card.innerHTML = â€˜<div class="scan-card-grid">â€™ +
â€˜<div class="scan-col"><span class="scan-col-label">ğŸ“¸ Captured (â€™ + scanCardCount + â€˜)</span>â€™ +
â€˜<img src="' + imgSrc + '" style="width:100%;border-radius:6px;margin-bottom:8px;max-height:140px;object-fit:contain;">â€™ +
â€˜<p class="scan-captured" style="font-size:0.78rem;color:var(--text-muted);">â€™ + capturedText + â€˜</p></div>â€™ +
â€˜<div class="scan-col"><span class="scan-col-label">âœï¸ Your Notes</span>â€™ +
â€˜<textarea class="scan-note-ta" placeholder="Add your thoughts hereâ€¦"></textarea></div>â€™ +
â€˜</div>â€™;
container.appendChild(card);
}

// â”€â”€ RESEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap(â€˜addSourceBtnâ€™, function() { addSourceCard(); });

function addSourceCard() {
sourceCardCount++;
var container = el(â€˜sourceCardsâ€™);
var id = â€˜scâ€™ + sourceCardCount;
var card = document.createElement(â€˜divâ€™); card.className = â€˜source-cardâ€™; card.id = id;
card.innerHTML =
â€˜<div class="source-card-header">â€™ +
â€˜<select class="source-type-select" id="' + id + '-type">â€™ +
â€˜<option>Journal Article</option><option>Book</option><option>Website</option>â€™ +
â€˜<option>Book Chapter</option><option>YouTube / Video</option><option>Lecture / Slides</option><option>Other</option>â€™ +
â€˜</select>â€™ +
â€˜<input class="source-title-input" type="text" placeholder="Source title or URLâ€¦">â€™ +
â€˜<div class="relevance-btns">â€™ +
â€˜<button class="rel-btn" data-rel="green">ğŸŸ¢</button>â€™ +
â€˜<button class="rel-btn" data-rel="amber">ğŸŸ¡</button>â€™ +
â€˜<button class="rel-btn" data-rel="red">ğŸ”´</button>â€™ +
â€˜</div>â€™ +
â€˜</div>â€™ +
â€˜<div class="source-card-body">â€™ +
â€˜<div class="source-col">â€™ +
â€˜<span class="source-col-label">ğŸ’¬ Direct Quote</span>â€™ +
â€˜<textarea class="source-ta" id="' + id + '-quote" placeholder="Copy the exact quote hereâ€¦"></textarea>â€™ +
â€˜<span class="source-col-label" style="margin-top:10px">ğŸ”„ In Your Own Words</span>â€™ +
â€˜<textarea class="source-ta" id="' + id + '-paraphrase" placeholder="Say it in your own wordsâ€¦"></textarea>â€™ +
â€˜</div>â€™ +
â€˜<div class="source-col">â€™ +
â€˜<span class="source-col-label">ğŸ’¡ Why This Matters</span>â€™ +
â€˜<textarea class="source-ta" id="' + id + '-why" placeholder="Why relevant to your assignment question?"></textarea>â€™ +
â€˜</div>â€™ +
â€˜</div>â€™ +
â€˜<div class="source-card-footer">â€™ +
â€˜<div class="section-title" style="margin-bottom:8px">ğŸ“ APA 7 Reference Builder</div>â€™ +
â€˜<div class="apa-fields">â€™ +
â€˜<input class="apa-input" id="' + id + '-author" placeholder="Author(s) e.g. Smith, J.">â€™ +
â€˜<input class="apa-input" id="' + id + '-year" placeholder="Year e.g. 2023">â€™ +
â€˜<input class="apa-input" id="' + id + '-title" placeholder="Title of work">â€™ +
â€˜<input class="apa-input" id="' + id + '-journal" placeholder="Journal / Publisher">â€™ +
â€˜<input class="apa-input" id="' + id + '-vol" placeholder="Vol(issue), pages">â€™ +
â€˜<input class="apa-input" id="' + id + '-doi" placeholder="DOI or URL">â€™ +
â€˜</div>â€™ +
â€˜<div class="apa-preview" id="' + id + '-preview">Fill in Author, Year and Title to generate APA 7 â†’</div>â€™ +
â€˜<div class="apa-resources">â€™ +
â€˜<a href="https://owl.purdue.edu/owl/research_and_citation/apa_style/apa_formatting_and_style_guide/general_format.html" target="_blank" rel="noopener" class="apa-link">ğŸ“š Purdue OWL</a>â€™ +
â€˜<a href="https://apastyle.apa.org" target="_blank" rel="noopener" class="apa-link">ğŸ›ï¸ APA Official</a>â€™ +
â€˜<a href="https://www.scribbr.com/apa-citation-generator/" target="_blank" rel="noopener" class="apa-link">âš¡ Scribbr</a>â€™ +
â€˜</div>â€™ +
â€˜</div>â€™;
container.appendChild(card);
card.querySelectorAll(â€™.rel-btnâ€™).forEach(function(btn) {
btn.addEventListener(â€˜clickâ€™, function() {
card.querySelectorAll(â€™.rel-btnâ€™).forEach(function(b) { b.classList.remove(â€˜activeâ€™); });
this.classList.add(â€˜activeâ€™);
});
});
[â€˜authorâ€™,â€˜yearâ€™,â€˜titleâ€™,â€˜journalâ€™,â€˜volâ€™,â€˜doiâ€™].forEach(function(f) {
var inp = el(id + â€˜-â€™ + f);
if (inp) inp.addEventListener(â€˜inputâ€™, function() { updateAPA(id); });
});
var typeEl = el(id + â€˜-typeâ€™);
if (typeEl) typeEl.addEventListener(â€˜changeâ€™, function() { updateAPA(id); });
}

function getVal(id) { var e = el(id); return e ? e.value.trim() : â€˜â€™; }

function updateAPA(id) {
var author = getVal(id+â€™-authorâ€™), year = getVal(id+â€™-yearâ€™), title = getVal(id+â€™-titleâ€™);
var journal = getVal(id+â€™-journalâ€™), vol = getVal(id+â€™-volâ€™), doi = getVal(id+â€™-doiâ€™);
var typeEl = el(id+â€™-typeâ€™);
var type = typeEl ? typeEl.value : â€˜Journal Articleâ€™;
var p = â€˜â€™;
if (author && year && title) {
if (type === â€˜Journal Articleâ€™) {
p = author+â€™ (â€™+year+â€™). â€˜+title+â€™. <em>â€™+journal+â€™</em>â€™;
if (vol) p += â€˜, â€˜+vol;
if (doi) p += â€˜. https://doi.org/â€™+doi.replace(â€˜https://doi.org/â€™,â€™â€™);
} else if (type === â€˜Bookâ€™) {
p = author+â€™ (â€™+year+â€™). <em>â€™+title+â€™</em>. â€˜+journal+â€™.â€™;
} else if (type === â€˜Websiteâ€™) {
p = author+â€™ (â€™+year+â€™). â€˜+title+â€™. â€˜+journal+â€™. â€˜+doi;
} else if (type === â€˜Book Chapterâ€™) {
p = author+â€™ (â€™+year+â€™). â€˜+title+â€™. In <em>â€™+journal+â€™</em> (pp. â€˜+vol+â€™).â€™;
} else if (type === â€˜YouTube / Videoâ€™) {
p = author+â€™ [â€™+journal+â€™]. (â€™+year+â€™). <em>â€™+title+â€™</em> [Video]. YouTube. â€˜+doi;
} else {
p = author+â€™ (â€™+year+â€™). â€˜+title+â€™. â€˜+journal+â€™. â€˜+doi;
}
} else {
p = â€˜Fill in Author, Year and Title to generate APA 7 â†’â€™;
}
var prev = el(id+â€™-previewâ€™); if (prev) prev.innerHTML = p;
}

// â”€â”€ BIONIC READING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap(â€˜bionicBtnâ€™, function() {
bionicOn = !bionicOn;
el(â€˜bionicBtnâ€™).classList.toggle(â€˜onâ€™, bionicOn);
buildReview();
});

function escHTML(s) {
return String(s).replace(/&/g,â€™&â€™).replace(/</g,â€™<â€™).replace(/>/g,â€™>â€™);
}

function bionicify(text) {
if (!text || !bionicOn) return escHTML(text);
return text.split(/\b/).map(function(word) {
if (/[a-zA-Z]/.test(word) && word.length > 1) {
var cut = Math.ceil(word.length * 0.45);
return â€˜<b>â€™ + escHTML(word.slice(0,cut)) + â€˜</b>â€™ + escHTML(word.slice(cut));
}
return escHTML(word);
}).join(â€™â€™);
}

// â”€â”€ READING RULER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap(â€˜rulerBtnâ€™, function() {
rulerOn = !rulerOn;
el(â€˜rulerBtnâ€™).classList.toggle(â€˜onâ€™, rulerOn);
document.querySelectorAll(â€™.review-contentâ€™).forEach(function(e) {
e.classList.toggle(â€˜ruler-onâ€™, rulerOn);
});
});

// â”€â”€ REVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setReview(id, text) {
var node = el(id); if (!node) return;
node.classList.toggle(â€˜ruler-onâ€™, rulerOn);
if (bionicOn) { node.innerHTML = â€˜<span class="bionic-word">â€™ + bionicify(text) + â€˜</span>â€™; }
else { node.textContent = text; }
}

function buildReview() {
setReview(â€˜review-freeâ€™, el(â€˜freeNotesâ€™).value || â€˜No free notes this session.â€™);
setReview(â€˜review-cueâ€™, el(â€˜cornellCueâ€™).value || â€˜â€”â€™);
setReview(â€˜review-mainâ€™, el(â€˜cornellMainâ€™).value || â€˜â€”â€™);
setReview(â€˜review-summaryâ€™, el(â€˜cornellSummaryâ€™).value || â€˜â€”â€™);
var confEl = el(â€˜review-confusionâ€™);
if (!confusionPoints.length) {
confEl.innerHTML = â€˜<p style="color:var(--text-muted);font-size:0.9rem">No confusion moments logged.</p>â€™;
} else {
confEl.innerHTML = confusionPoints.map(function(cp) {
return â€˜<div class="confusion-item"><div class="confusion-timestamp">â€™+cp.time+â€™</div>â€™ +
â€˜<div style="font-size:0.88rem;color:var(--text-muted);flex:1">â€™+(cp.note||â€˜Review recording at this pointâ€™)+â€™</div></div>â€™;
}).join(â€™â€™);
}
}

// â”€â”€ EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tap(â€˜copyBtnâ€™, function() {
navigator.clipboard.writeText(buildExport()).then(function() { showToast(â€˜Notes copied âœ“â€™); });
});

tap(â€˜downloadBtnâ€™, function() {
var session = el(â€˜sessionNameâ€™).value || â€˜flux-notesâ€™;
var blob = new Blob([buildExport()], { type: â€˜text/plainâ€™ });
var a = document.createElement(â€˜aâ€™);
a.href = URL.createObjectURL(blob);
a.download = session.replace(/\s+/g,â€™-â€™) + â€˜-notes.txtâ€™;
a.click();
});

function buildExport() {
var session = el(â€˜sessionNameâ€™).value || â€˜Sessionâ€™;
var text = â€˜FLUX NOTES â€” â€™ + session + â€˜\nâ€™ + â€˜=â€™.repeat(40) + â€˜\n\nâ€™;
var free = el(â€˜freeNotesâ€™).value;
if (free) text += â€˜FREE NOTES:\nâ€™ + free + â€˜\n\nâ€™;
var cue = el(â€˜cornellCueâ€™).value, main = el(â€˜cornellMainâ€™).value, sum = el(â€˜cornellSummaryâ€™).value;
if (cue||main||sum) text += â€˜CORNELL:\nCues: â€˜+cue+â€™\nNotes: â€˜+main+â€™\nSummary: â€˜+sum+â€™\n\nâ€™;
if (confusionPoints.length) {
text += â€˜CONFUSION MOMENTS:\nâ€™;
confusionPoints.forEach(function(cp) { text += â€˜â€¢ â€™ + cp.time + â€˜: â€™ + (cp.note||â€˜Review recordingâ€™) + â€˜\nâ€™; });
text += â€˜\nâ€™;
}
document.querySelectorAll(â€™.source-cardâ€™).forEach(function(card, i) {
var id = card.id;
var titleEl = card.querySelector(â€™.source-title-inputâ€™);
text += â€˜\nSource â€™ + (i+1) + â€˜: â€™ + (titleEl ? titleEl.value : â€˜â€™) + â€˜\nâ€™;
var q = el(id+â€™-quoteâ€™), pa = el(id+â€™-paraphraseâ€™), w = el(id+â€™-whyâ€™), pr = el(id+â€™-previewâ€™);
if (q && q.value) text += â€™Quote: â€™ + q.value + â€˜\nâ€™;
if (pa && pa.value) text += â€™Paraphrase: â€™ + pa.value + â€˜\nâ€™;
if (w && w.value) text += â€™Relevance: â€™ + w.value + â€˜\nâ€™;
if (pr && pr.textContent && !pr.textContent.includes(â€˜Fill inâ€™)) text += â€™APA 7: â€™ + pr.textContent + â€˜\nâ€™;
});
return text;
}

// â”€â”€ VISUAL NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var vCanvas = el(â€˜visualCanvasâ€™);
var vCtx = vCanvas ? vCanvas.getContext(â€˜2dâ€™) : null;
var vWrap = el(â€˜visualCanvasWrapâ€™);
var vDrawing = false;
var vTool = â€˜drawâ€™;
var vColor = â€˜#7eb8f7â€™;
var vBrush = 6;
var vLastX = 0, vLastY = 0;

function vBgColor() { return document.body.classList.contains(â€˜dayâ€™) ? â€˜#f5f0e8â€™ : â€˜#0f1117â€™; }

function resizeCanvas() {
if (!vCanvas || !vWrap || !vCtx) return;
var saved = vCtx.getImageData(0, 0, vCanvas.width, vCanvas.height);
vCanvas.width = vWrap.offsetWidth || 300;
vCanvas.height = Math.max(400, vCanvas.width * 0.6);
vCtx.fillStyle = vBgColor();
vCtx.fillRect(0, 0, vCanvas.width, vCanvas.height);
if (saved.width > 0) { try { vCtx.putImageData(saved, 0, 0); } catch(e){} }
}
resizeCanvas();
window.addEventListener(â€˜resizeâ€™, resizeCanvas);

tap(â€˜themeBtnâ€™, function() {
setTimeout(function() {
if (!vCtx || !vCanvas) return;
var saved = vCtx.getImageData(0, 0, vCanvas.width, vCanvas.height);
vCtx.fillStyle = vBgColor();
vCtx.fillRect(0, 0, vCanvas.width, vCanvas.height);
try { vCtx.putImageData(saved, 0, 0); } catch(e){}
}, 60);
});

function vGetPos(e) {
if (!vCanvas) return {x:0,y:0};
var rect = vCanvas.getBoundingClientRect();
var scaleX = vCanvas.width / rect.width;
var scaleY = vCanvas.height / rect.height;
if (e.touches && e.touches.length) {
return { x:(e.touches[0].clientX-rect.left)*scaleX, y:(e.touches[0].clientY-rect.top)*scaleY };
}
return { x:(e.clientX-rect.left)*scaleX, y:(e.clientY-rect.top)*scaleY };
}

if (vCanvas) {
vCanvas.addEventListener(â€˜mousedownâ€™, function(e) {
if (vTool === â€˜textâ€™) return;
vDrawing = true; var p = vGetPos(e); vLastX = p.x; vLastY = p.y;
vCtx.beginPath();
vCtx.arc(vLastX, vLastY, (vTool===â€˜eraseâ€™?vBrush*3:vBrush)/2, 0, Math.PI*2);
vCtx.fillStyle = vTool===â€˜eraseâ€™ ? vBgColor() : vColor;
vCtx.fill();
});
vCanvas.addEventListener(â€˜mousemoveâ€™, function(e) {
if (!vDrawing) return;
var p = vGetPos(e);
vCtx.beginPath(); vCtx.moveTo(vLastX,vLastY); vCtx.lineTo(p.x,p.y);
vCtx.strokeStyle = vTool===â€˜eraseâ€™ ? vBgColor() : vColor;
vCtx.lineWidth = vTool===â€˜eraseâ€™ ? vBrush*3 : vBrush;
vCtx.lineCap = â€˜roundâ€™; vCtx.lineJoin = â€˜roundâ€™; vCtx.stroke();
vLastX = p.x; vLastY = p.y;
});
vCanvas.addEventListener(â€˜mouseupâ€™, function() { vDrawing = false; });
vCanvas.addEventListener(â€˜mouseleaveâ€™, function() { vDrawing = false; });
vCanvas.addEventListener(â€˜touchstartâ€™, function(e) {
e.preventDefault();
if (vTool === â€˜textâ€™) return;
vDrawing = true; var p = vGetPos(e); vLastX = p.x; vLastY = p.y;
vCtx.beginPath();
vCtx.arc(vLastX, vLastY, (vTool===â€˜eraseâ€™?vBrush*3:vBrush)/2, 0, Math.PI*2);
vCtx.fillStyle = vTool===â€˜eraseâ€™ ? vBgColor() : vColor;
vCtx.fill();
}, { passive: false });
vCanvas.addEventListener(â€˜touchmoveâ€™, function(e) {
e.preventDefault();
if (!vDrawing) return;
var p = vGetPos(e);
vCtx.beginPath(); vCtx.moveTo(vLastX,vLastY); vCtx.lineTo(p.x,p.y);
vCtx.strokeStyle = vTool===â€˜eraseâ€™ ? vBgColor() : vColor;
vCtx.lineWidth = vTool===â€˜eraseâ€™ ? vBrush*3 : vBrush;
vCtx.lineCap = â€˜roundâ€™; vCtx.lineJoin = â€˜roundâ€™; vCtx.stroke();
vLastX = p.x; vLastY = p.y;
}, { passive: false });
vCanvas.addEventListener(â€˜touchendâ€™, function(e) { e.preventDefault(); vDrawing = false; }, { passive: false });
}

tapAll(â€™#vt-draw,#vt-text,#vt-eraseâ€™, function() {
vTool = this.id.replace(â€˜vt-â€™,â€™â€™);
document.querySelectorAll(â€™#vt-draw,#vt-text,#vt-eraseâ€™).forEach(function(b) { b.classList.remove(â€˜activeâ€™); });
this.classList.add(â€˜activeâ€™);
if (vCanvas) vCanvas.style.cursor = vTool===â€˜eraseâ€™ ? â€˜cellâ€™ : vTool===â€˜textâ€™ ? â€˜textâ€™ : â€˜crosshairâ€™;
});

var vtSize = el(â€˜vt-size-selectâ€™);
if (vtSize) vtSize.addEventListener(â€˜changeâ€™, function() { vBrush = parseInt(this.value); });

tapAll(â€™.vt-colorâ€™, function() {
document.querySelectorAll(â€™.vt-colorâ€™).forEach(function(c) { c.classList.remove(â€˜activeâ€™); });
this.classList.add(â€˜activeâ€™);
vColor = this.getAttribute(â€˜data-colorâ€™);
});

tap(â€˜vt-clearâ€™, function() {
if (!vCtx || !vCanvas) return;
vCtx.fillStyle = vBgColor();
vCtx.fillRect(0, 0, vCanvas.width, vCanvas.height);
});

tap(â€˜vt-save-pngâ€™, function() {
if (!vCanvas) return;
var a = document.createElement(â€˜aâ€™);
a.download = â€˜flux-visual-notes.pngâ€™;
a.href = vCanvas.toDataURL(â€˜image/pngâ€™);
a.click();
});

var vtUpload = el(â€˜vt-uploadâ€™);
if (vtUpload) vtUpload.addEventListener(â€˜changeâ€™, function(e) {
var file = e.target.files[0]; if (!file) return;
var reader = new FileReader();
reader.onload = function(ev) {
var img = new Image();
img.onload = function() {
var maxW = vCanvas.width * 0.6;
var scale = Math.min(maxW / img.width, 1);
vCtx.drawImage(img, 20, 20, img.width*scale, img.height*scale);
};
img.src = ev.target.result;
};
reader.readAsDataURL(file);
this.value = â€˜â€™;
});

tap(â€˜pixabaySearchBtnâ€™, function() { doPixabaySearch(); });
var pbInput = el(â€˜pixabayInputâ€™);
if (pbInput) pbInput.addEventListener(â€˜keydownâ€™, function(e) { if (e.key===â€˜Enterâ€™) doPixabaySearch(); });

function doPixabaySearch() {
var query = el(â€˜pixabayInputâ€™) ? el(â€˜pixabayInputâ€™).value.trim() : â€˜â€™;
if (!query) return;
var grid = el(â€˜pixabayGridâ€™);
grid.innerHTML = â€˜<div class="pixabay-empty">Searchingâ€¦</div>â€™;
var url = â€˜https://pixabay.com/api/?key=46494683-e5e2e2d4a3c28e05f8a8a7d8a&q=â€™ + encodeURIComponent(query) + â€˜&image_type=photo&per_page=18&safesearch=trueâ€™;
fetch(url).then(function(r) { return r.json(); }).then(function(data) {
if (!data.hits || !data.hits.length) {
grid.innerHTML = â€˜<div class="pixabay-empty">No images found â€” try another term.</div>â€™; return;
}
grid.innerHTML = â€˜â€™;
data.hits.forEach(function(hit) {
var img = document.createElement(â€˜imgâ€™);
img.className = â€˜pixabay-imgâ€™; img.src = hit.previewURL; img.alt = hit.tags;
img.addEventListener(â€˜clickâ€™, function() {
var full = new Image(); full.crossOrigin = â€˜anonymousâ€™;
full.onload = function() {
var maxW = vCanvas.width * 0.45;
var scale = Math.min(maxW / full.width, 1);
vCtx.drawImage(full, Math.floor(vCanvas.width/2-full.width*scale/2), Math.floor(vCanvas.height/2-full.height*scale/2), full.width*scale, full.height*scale);
showToast(â€˜Image added to canvas âœ“â€™);
};
full.onerror = function() { showToast(â€˜Could not load image â€” try anotherâ€™); };
full.src = hit.webformatURL;
});
grid.appendChild(img);
});
}).catch(function() {
grid.innerHTML = â€˜<div class="pixabay-empty">Search failed â€” check your connection.</div>â€™;
});
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
addSourceCard();

} catch(err) {
console.error(â€˜Flux Notes init error:â€™, err);
}
}); // end window load
</script>

</body>
</html>
